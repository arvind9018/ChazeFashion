{% extends 'base.html' %}

{% block title %}Your Cart - ChazeFashion{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-4xl font-bold text-center mb-8 text-fashion-dark">
        <i class="fas fa-shopping-cart mr-3 text-fashion-primary"></i>
        Your Shopping Cart
    </h1>

    {% if cart_items %}
    <form method="post" action="{% url 'cart' %}" class="mb-8">
        {% csrf_token %}
        <div class="bg-white rounded-xl shadow-md overflow-hidden">
            <div class="overflow-x-auto">
                <table class="table w-full">
                    <!-- Table Header -->
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="text-left py-4 px-6 font-semibold text-gray-700">Product</th>
                            <th class="text-right py-4 px-6 font-semibold text-gray-700">Price</th>
                            <th class="text-center py-4 px-6 font-semibold text-gray-700">Quantity</th>
                            <th class="text-right py-4 px-6 font-semibold text-gray-700">Total</th>
                            <th class="text-center py-4 px-6 font-semibold text-gray-700">Actions</th>
                        </tr>
                    </thead>

                    <!-- Table Body -->
                    <tbody class="divide-y divide-gray-200">
                        {% for item in cart_items %}
                        <tr class="hover:bg-gray-50 transition-colors duration-200">
                            <!-- Product Column -->
                            <td class="py-4 px-6">
                                <div class="flex items-center space-x-4">
                                    {% if item.product.pr_images %}
                                    <div class="avatar">
                                        <div class="mask mask-squircle w-16 h-16">
                                            <img src="{{ item.product.pr_images.url }}" alt="{{ item.product.pr_name }}"
                                                class="object-cover hover:scale-105 transition-transform duration-300" />
                                        </div>
                                    </div>
                                    {% else %}
                                    <div class="avatar">
                                        <div
                                            class="mask mask-squircle w-16 h-16 bg-gray-200 flex items-center justify-center">
                                            <i class="fas fa-tshirt text-2xl text-gray-400"></i>
                                        </div>
                                    </div>
                                    {% endif %}
                                    <div>
                                        <div class="font-bold text-gray-800">{{ item.product.pr_name }}</div>
                                        <div class="text-sm text-gray-500">{{ item.product.pr_cate }}</div>
                                        {% if item.product.pr_stk_quant < 5 %} <div
                                            class="text-xs text-fashion-secondary mt-1">
                                            <i class="fas fa-exclamation-circle"></i> Only {{ item.product.pr_stk_quant
                                            }} left in stock!
                                    </div>
                                    {% endif %}
                                </div>
            </div>
            </td>

            <!-- Price Column -->
            <td class="py-4 px-6 text-right font-medium text-gray-900">
                ${{ item.product.pr_price|floatformat:2 }}
            </td>

            <!-- Quantity Column -->
            <td class="py-4 px-6 text-center">
                <div class="flex items-center justify-center">
                    <input type="number" name="quantity_{{ item.id }}" value="{{ item.quantity }}" min="0"
                        max="{{ item.product.pr_stk_quant }}"
                        class="input input-bordered w-20 text-center focus:ring-2 focus:ring-fashion-primary" />
                </div>
            </td>

            <!-- Total Column -->
            <td class="py-4 px-6 text-right font-medium text-gray-900">
                ${{ item.get_item_total|floatformat:2 }}
            </td>

            <!-- Actions Column -->
            <td class="py-4 px-6 text-center">
                <button type="submit" name=<form method="POST" action="{% url 'remove_from_cart' item.id %}">
                    {% csrf_token %}

    </form>


    </button>
    <form method="POST" action="{% url 'remove_from_cart' item.id %}">
        {% csrf_token %}
        <button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md">
            Remove
        </button>
    </form>
    </td>
    </tr>
    {% endfor %}
    </tbody>

    <!-- Table Footer -->
    <tfoot class="bg-gray-50">
    <tr>
        <td colspan="3" class="text-right py-4 px-6 font-bold text-xl text-blue-700">
            Grand Total:
        </td>
        <td class="text-right py-4 px-6 font-bold text-xl text-fashion-primary">
            ${{ total|floatformat:2 }}
        </td>
        <td></td>
    </tr>
</tfoot>
    </table>
</div>
</div>

<!-- Action Buttons -->
<div class="flex flex-col sm:flex-row justify-end mt-8 gap-4">
    <a href="{% url 'product_list' %}"
        class="btn btn-outline border-gray-300 text-gray-700 hover:bg-gray-100 flex-grow sm:flex-grow-0">
        <i class="fas fa-arrow-left mr-2"></i> Continue Shopping
    </a>

    <div class="flex justify-end mt-4 space-x-4">
        <button type="submit" name="update_cart" class="btn btn-info">Update Cart</button>
        <a href="{% url 'product_list' %}" class="btn btn-outline">Continue Shopping</a>
        {# Updated button to link to the new checkout URL #}
        <a href="{% url 'checkout' %}" class="btn btn-primary">Proceed to Checkout</a>
    </div>
</div>
</form>

{% else %}
<!-- Empty Cart State -->
<div class="text-center py-16 bg-white rounded-xl shadow-sm">
    <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
        <i class="fas fa-shopping-cart text-3xl text-gray-400"></i>
    </div>
    <h2 class="text-2xl font-semibold text-gray-800 mb-3">Your cart is empty</h2>
    <p class="text-gray-600 mb-6 max-w-md mx-auto">Looks like you haven't added any items to your cart yet. Start
        shopping to find amazing fashion deals!</p>
    <a href="{% url 'product_list' %}" class="btn btn-fancy px-8">
        <i class="fas fa-bag-shopping mr-2"></i> Start Shopping
    </a>
</div>
{% endif %}
</div>

<style>
    /* Custom table styling */
    .table th,
    .table td {
        padding: 1rem 1.5rem;
    }

    /* Hover effect for table rows */
    .table tbody tr:hover {
        background-color: #f9fafb;
    }

    /* Custom focus for quantity input */
    .input:focus {
        box-shadow: 0 0 0 2px rgba(108, 99, 255, 0.2);
        border-color: rgba(108, 99, 255, 0.5);
    }
</style>
{% endblock %}